import{j as a}from"./jsx-runtime-u17CrQMm.js";import{u as H,f as B,a as R,b as Q,c as U,A as z,d as F,h as V,Q as K,e as J,H as Y}from"./index-B_7-ghFa.js";import{E as W}from"./index-PL6PNkgw.js";import{r as m}from"./iframe-DgPYzqpe.js";import{c as y}from"./createLucideIcon--1YttshL.js";import{S as Z}from"./settings-rBDbH9ea.js";import"./index-QWo0TafW.js";import"./index-BpJ1TsX4.js";import{H as X}from"./index-CbPuT_cU.js";import"./index-BKtDPDeF.js";import"./index-jpiqNomA.js";import{L as ee}from"./index-B8Qz_kmH.js";import"./index-CVMb33GB.js";import"./index-DS7-BfzZ.js";import"./index-BJWHGE4S.js";import"./index-CJeEdFRN.js";import{D as N}from"./index-CFKCDqns.js";import{a as $,S as te}from"./index-C5gDiuNf.js";import"./index-D1K1ShiV.js";import"./index-DGJr4RFe.js";import{g as oe}from"./index-DxZmMVmD.js";import{u as re}from"./useErrorModal-CoDQ8pQO.js";import{G as ne}from"./index-CcT8jNQF.js";import"./preload-helper-PPVm8Dsz.js";import"./index-7bAGbm2-.js";import"./Combination-DZFs7yCN.js";import"./index-dq_V4s_O.js";import"./index-CNOlc07V.js";import"./x-BGrllKwE.js";import"./chunk-JMJ3UQ3L-CwqGpck2.js";import"./crown-DfmeESoy.js";import"./index-C91NJoOY.js";import"./chevron-down-CyG34Q_4.js";import"./check-BvMWPE1O.js";const ae=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],se=y("chart-column",ae);const ie=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]],ce=y("clipboard-list",ie);const de=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16.5 12",key:"1aq6pp"}]],ue=y("clock-3",de);const me=[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]],le=y("house",me),S=m.createContext(null);function G({value:e,children:n}){return a.jsx(S.Provider,{value:e,children:n})}function pe(){const e=m.useContext(S);if(!e)throw new Error("GroupLayoutProvider が見つかりません。グループ配下のレイアウトでラップしてください。");return e}G.__docgenInfo={description:"",methods:[],displayName:"GroupLayoutProvider",props:{value:{required:!0,tsType:{name:"GroupLayoutValue"},description:""},children:{required:!0,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:""}}};const he=(e,n,t)=>{const o=`/groups/${e}`,r={groupName:n};return[{label:"ホーム",to:o,icon:le,isActive:t===o,state:r},{label:"レポート",to:`${o}/reports`,icon:se,isActive:t===`${o}/reports`,state:r},{label:"家事",to:`${o}/chores`,icon:ce,isActive:t===`${o}/chores`,state:r},{label:"設定",to:`${o}/settings`,icon:Z,isActive:t===`${o}/settings`,state:r}]},ge="_floatingAction_jf9xz_1",ye={floatingAction:ge},fe=e=>new Intl.DateTimeFormat("ja-JP",{timeZone:"Asia/Tokyo",...e}),f=e=>{const t=fe({year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",hour12:!1}).formatToParts(e),o=r=>t.find(s=>s.type===r)?.value??"";return{year:o("year"),month:o("month"),day:o("day"),hour:o("hour")}},A=e=>{const{year:n,month:t,day:o}=f(e);return`${n}-${t}-${o}`},be=(e,n=new Date)=>{const{year:t,month:o,day:r}=f(n),s=String(e).padStart(2,"0");return`${t}-${o}-${r}T${s}:00:00+09:00`},_e="_form_1tqiv_1",ve="_section_1tqiv_7",xe="_sectionHeader_1tqiv_13",Ce="_sectionIcon_1tqiv_22",d={form:_e,section:ve,sectionHeader:xe,sectionIcon:Ce},g=e=>`${String(e)}時`,Ne=e=>Array.from({length:24},(n,t)=>{const o=g(t),r=g((t+1)%24),s=`${o}〜${r}`;return{value:s,label:s,disabled:t>e}}),w=()=>{const e=new Date,n=f(e).hour,t=Number(n),o=Number.isNaN(t)?e.getHours():t,r=g(o),s=g((o+1)%24);return`${r}〜${s}`},we=e=>{const n=/^(\d{1,2})時〜/.exec(e);if(!n)return null;const t=Number(n[1]);return Number.isNaN(t)||t<0||t>23?null:t};function M({open:e,onOpenChange:n,choreOptions:t,choresLoading:o=!1,isSubmitting:r=!1,onSubmit:s}){const[i,l]=m.useState(void 0),[p,c]=m.useState(w),b=!i||r,v=f(new Date),x=Number(v.hour),T=Number.isNaN(x)?new Date().getHours():x,D=Ne(T),C=v,E=`本日 ${`${C.month}月${C.day}日`}の討伐として記録されます！`,L=()=>{l(void 0),c(w())},_=u=>{u||L(),n(u)},O=async()=>{if(!i||r)return;const u=we(p);if(u!==null)try{await s({choreId:Number(i),startHour:u}),_(!1)}catch{}};return a.jsx(X,{open:e,onOpenChange:_,title:"家事を討伐する",headerIcon:a.jsx(te,{size:"sm","aria-hidden":!0}),primaryActionLabel:"討伐完了",secondaryActionLabel:"キャンセル",primaryActionDisabled:b,primaryActionLoading:r,secondaryActionDisabled:r,onPrimaryAction:()=>{O()},onSecondaryAction:()=>{_(!1)},children:a.jsxs("div",{className:d.form,children:[a.jsxs("section",{className:d.section,"aria-labelledby":"chore-select-heading",children:[a.jsxs("div",{id:"chore-select-heading",className:d.sectionHeader,children:[a.jsx($,{className:d.sectionIcon,"aria-hidden":!0}),a.jsx("span",{children:"討伐する家事を選択"})]}),a.jsx(N,{placeholder:"家事を選択しよう！",emptyMessage:o?a.jsx(ee,{size:"md",ariaLabel:"家事を読み込み中"}):"討伐する家事がありません、、！",options:t,value:i,onChange:l,disabled:o})]}),a.jsxs("section",{className:d.section,"aria-labelledby":"battle-time-heading",children:[a.jsxs("div",{id:"battle-time-heading",className:d.sectionHeader,children:[a.jsx(ue,{className:d.sectionIcon,"aria-hidden":!0}),a.jsx("span",{children:"討伐時刻"})]}),a.jsx(N,{options:D,value:p,onChange:c,helperText:E,helperTextVariant:"notice"})]})]})})}M.__docgenInfo={description:"",methods:[],displayName:"ChoreBeatingModal",props:{open:{required:!0,tsType:{name:"boolean"},description:""},onOpenChange:{required:!0,tsType:{name:"signature",type:"function",raw:"(open: boolean) => void",signature:{arguments:[{type:{name:"boolean"},name:"open"}],return:{name:"void"}}},description:""},choreOptions:{required:!0,tsType:{name:"Array",elements:[{name:"DropdownOption"}],raw:"DropdownOption[]"},description:""},choresLoading:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},isSubmitting:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},onSubmit:{required:!0,tsType:{name:"signature",type:"function",raw:"(payload: { choreId: number; startHour: number }) => Promise<void>",signature:{arguments:[{type:{name:"signature",type:"object",raw:"{ choreId: number; startHour: number }",signature:{properties:[{key:"choreId",value:{name:"number",required:!0}},{key:"startHour",value:{name:"number",required:!0}}]}},name:"payload"}],return:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}}},description:""}}};const je=e=>["groups",e,"chores"],q=(e,n)=>["groups",e,"beatings",n],Ie=e=>{const n=e??"";return H({queryKey:je(n),queryFn:()=>B({groupId:n}),enabled:!!e})},ke=()=>{const e=R(),{showError:n,closeError:t,getModalMessage:o}=re();return Q({mutationFn:({groupId:r,choreId:s,startHour:i})=>U({groupId:r,chore_id:s,beated_at:be(i)}),onSuccess:async(r,s)=>{const i=A(new Date);await e.invalidateQueries({queryKey:q(s.groupId,i)}),t()},onError:r=>{const s=r instanceof z?r.status:void 0,i=r instanceof Error&&r.message?r.message:"討伐記録の作成に失敗しました";n({title:"討伐エラー",message:s?o(s):i})}})},j=e=>(e?.trim()??"")||"名前",He=e=>e.map(n=>({timeLabel:n.hour,items:n.items.map(t=>{const o=t.messages.map(r=>({id:String(r.id),userName:j(r.user_name),userImageUrl:r.img_url,mainMessage:r.main_message,describeMessage:r.description_message??void 0}));return{id:String(t.beating_id),choreIconCode:t.icon_code,choreName:t.chore_name,userName:j(t.user_name),userImageUrl:t.img_url,likeCount:t.thanks_count,commentCount:o.length,messages:o}})})),$e=(e,n)=>{const t=e??"",o=A(new Date);return H({queryKey:q(t,o),queryFn:()=>F({groupId:t,date:o}),select:He,enabled:!!e})};function P(){const{groupId:e}=pe(),[n,t]=m.useState(!1),{data:o,isLoading:r}=Ie(e),{data:s}=$e(e),{mutateAsync:i,isPending:l}=ke(),p=o?.map(c=>({value:String(c.id),label:c.name,icon:a.jsx("span",{"aria-hidden":!0,children:oe(c.icon_code)})}))??[];return a.jsxs(a.Fragment,{children:[a.jsx(M,{open:n,onOpenChange:t,choreOptions:p,choresLoading:r,isSubmitting:l,onSubmit:async({choreId:c,startHour:b})=>{e&&await i({groupId:e,choreId:c,startHour:b})}}),a.jsx(ne,{beatingGroups:s??[]}),a.jsx("button",{type:"button",className:ye.floatingAction,"aria-label":"バトルを開く","aria-haspopup":"dialog",onClick:()=>{t(!0)},children:a.jsx($,{size:30})})]})}P.__docgenInfo={description:"",methods:[],displayName:"GroupHomePage"};const I="group-1",k="永井家",Se={id:"user-1",name:"山田 花子",email:"hanako@example.com",image:null},Ge=[{id:1,name:"食器洗い",icon_code:"dish-wash"},{id:2,name:"掃除",icon_code:"cleaning"},{id:3,name:"洗濯",icon_code:"laundry"}],pt={component:P,parameters:{layout:"fullscreen",msw:{handlers:[V.get(/\/api\/groups\/[^/]+\/chores$/,()=>Y.json(Ge))]}},decorators:[e=>{const n=new K({defaultOptions:{queries:{refetchOnWindowFocus:!1}}});return a.jsx(J,{client:n,children:a.jsx(W,{children:a.jsx(G,{value:{groupId:I,groupName:k,navItems:he(I,k),currentUser:Se},children:a.jsx(e,{})})})})}]},h={};h.parameters={...h.parameters,docs:{...h.parameters?.docs,source:{originalSource:"{}",...h.parameters?.docs?.source}}};const ht=["Default"];export{h as Default,ht as __namedExportsOrder,pt as default};
