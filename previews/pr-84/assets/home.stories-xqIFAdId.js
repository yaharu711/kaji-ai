import{j as r}from"./jsx-runtime-u17CrQMm.js";import{u as H,f as J,a as F,b as V,c as K,A as Y,d as W,h as Z,Q as X,e as ee,H as te}from"./index-CRS_V-h7.js";import{E as oe}from"./index-Bkfa6NOu.js";import{r as l}from"./iframe-BavpLA4z.js";import{c as m}from"./createLucideIcon-rO1lRtKS.js";import{S as ne}from"./settings-hascDJhh.js";import{P as re}from"./index-D26oWmff.js";import"./index-Ced2qJuN.js";import{H as ae}from"./index-DezvXcnD.js";import"./index-BKtDPDeF.js";import"./index-BkSeV1t9.js";import{L as se}from"./index-DntQt44W.js";import"./index-CyBzRmC0.js";import"./index-DSvjV9HZ.js";import"./index-DgGOzuZG.js";import"./index-Dg9y3WAc.js";import{D as T}from"./index-C2W9Bu75.js";import{a as L,S as ie}from"./index-DGSGnhmS.js";import"./index-kRTNJ9dH.js";import"./index-BXenS7Yg.js";import{g as ce}from"./index-Dq_aW1VR.js";import{u as de}from"./useErrorModal-BqD0hm0k.js";import{G as ue}from"./index-CxnQDVi-.js";import"./preload-helper-PPVm8Dsz.js";import"./index-QyTzmSRK.js";import"./Combination-CpTBewC8.js";import"./index-cMMFw8Yh.js";import"./index-CKlUjPBx.js";import"./x-CODuA5_c.js";import"./chunk-JMJ3UQ3L-CyEUkArQ.js";import"./crown-GDIqBKzz.js";import"./index-CaWIL-9K.js";import"./chevron-down-D6q1KtjS.js";import"./check-Dm-X3tG8.js";const le=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],me=m("calendar",le);const pe=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],he=m("chart-column",pe);const ye=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],ge=m("chevron-left",ye);const fe=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],_e=m("chevron-right",fe);const be=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]],ve=m("clipboard-list",be);const xe=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16.5 12",key:"1aq6pp"}]],Ne=m("clock-3",xe);const je=[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]],Ce=m("house",je),D=l.createContext(null);function A({value:e,children:o}){return r.jsx(D.Provider,{value:e,children:o})}function ke(){const e=l.useContext(D);if(!e)throw new Error("GroupLayoutProvider が見つかりません。グループ配下のレイアウトでラップしてください。");return e}A.__docgenInfo={description:"",methods:[],displayName:"GroupLayoutProvider",props:{value:{required:!0,tsType:{name:"GroupLayoutValue"},description:""},children:{required:!0,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:""}}};const we=(e,o,t)=>{const n=`/groups/${e}`,a={groupName:o};return[{label:"ホーム",to:n,icon:Ce,isActive:t===n,state:a},{label:"レポート",to:`${n}/reports`,icon:he,isActive:t===`${n}/reports`,state:a},{label:"家事",to:`${n}/chores`,icon:ve,isActive:t===`${n}/chores`,state:a},{label:"設定",to:`${n}/settings`,icon:ne,isActive:t===`${n}/settings`,state:a}]},$e="_floatingAction_jf9xz_1",Se={floatingAction:$e},Te=e=>new Intl.DateTimeFormat("ja-JP",{timeZone:"Asia/Tokyo",...e}),h=()=>new Date,B=e=>new Date(`${e}T00:00:00+09:00`),g=e=>{const t=Te({year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",hour12:!1,weekday:"short"}).formatToParts(e),n=a=>t.find(s=>s.type===a)?.value??"";return{year:n("year"),month:n("month"),day:n("day"),hour:n("hour"),weekday:n("weekday")}},C=e=>{const{year:o,month:t,day:n}=g(e);return`${o}-${t}-${n}`},Ie=(e,o=h())=>{const{year:t,month:n,day:a}=g(o),s=String(e).padStart(2,"0");return`${t}-${n}-${a}T${s}:00:00+09:00`},I=(e,o)=>{const t=B(e);return t.setUTCDate(t.getUTCDate()+o),C(t)},qe="_form_1tqiv_1",Me="_section_1tqiv_7",Ge="_sectionHeader_1tqiv_13",Pe="_sectionIcon_1tqiv_22",u={form:qe,section:Me,sectionHeader:Ge,sectionIcon:Pe},j=e=>`${String(e)}時`,He=e=>Array.from({length:24},(o,t)=>{const n=j(t),a=j((t+1)%24),s=`${n}〜${a}`;return{value:s,label:s,disabled:t>e}}),q=()=>{const e=h(),o=g(e).hour,t=Number(o),n=Number.isNaN(t)?e.getHours():t,a=j(n),s=j((n+1)%24);return`${a}〜${s}`},Le=e=>{const o=/^(\d{1,2})時〜/.exec(e);if(!o)return null;const t=Number(o[1]);return Number.isNaN(t)||t<0||t>23?null:t};function E({open:e,onOpenChange:o,choreOptions:t,choresLoading:n=!1,isSubmitting:a=!1,onSubmit:s}){const[i,f]=l.useState(void 0),[_,b]=l.useState(q),k=!i||a,v=g(h()),y=Number(v.hour),w=He(y),x=v,$=`本日 ${`${x.month}月${x.day}日`}の討伐として記録されます！`,z=()=>{f(void 0),b(q())},S=p=>{!p&&a||(p||z(),o(p))},Q=async()=>{if(!i||a)return;const p=Le(_);if(p!==null)try{await s({choreId:Number(i),startHour:p}),S(!1)}catch{}};return r.jsx(ae,{open:e,onOpenChange:S,title:"家事を討伐する",headerIcon:r.jsx(ie,{size:"sm","aria-hidden":!0}),primaryActionLabel:"討伐完了",secondaryActionLabel:"キャンセル",primaryActionDisabled:k,primaryActionLoading:a,secondaryActionDisabled:a,onPrimaryAction:()=>{Q()},onSecondaryAction:()=>{S(!1)},children:r.jsxs("div",{className:u.form,children:[r.jsxs("section",{className:u.section,"aria-labelledby":"chore-select-heading",children:[r.jsxs("div",{id:"chore-select-heading",className:u.sectionHeader,children:[r.jsx(L,{className:u.sectionIcon,"aria-hidden":!0}),r.jsx("span",{children:"討伐する家事を選択"})]}),r.jsx(T,{placeholder:"家事を選択しよう！",emptyMessage:n?r.jsx(se,{size:"md",ariaLabel:"家事を読み込み中"}):"討伐する家事がありません、、！",options:t,value:i,onChange:f,disabled:n})]}),r.jsxs("section",{className:u.section,"aria-labelledby":"battle-time-heading",children:[r.jsxs("div",{id:"battle-time-heading",className:u.sectionHeader,children:[r.jsx(Ne,{className:u.sectionIcon,"aria-hidden":!0}),r.jsx("span",{children:"討伐時刻"})]}),r.jsx(T,{options:w,value:_,onChange:b,helperText:$,helperTextVariant:"notice"})]})]})})}E.__docgenInfo={description:"",methods:[],displayName:"ChoreBeatingModal",props:{open:{required:!0,tsType:{name:"boolean"},description:""},onOpenChange:{required:!0,tsType:{name:"signature",type:"function",raw:"(open: boolean) => void",signature:{arguments:[{type:{name:"boolean"},name:"open"}],return:{name:"void"}}},description:""},choreOptions:{required:!0,tsType:{name:"Array",elements:[{name:"DropdownOption"}],raw:"DropdownOption[]"},description:""},choresLoading:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},isSubmitting:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},onSubmit:{required:!0,tsType:{name:"signature",type:"function",raw:"(payload: { choreId: number; startHour: number }) => Promise<void>",signature:{arguments:[{type:{name:"signature",type:"object",raw:"{ choreId: number; startHour: number }",signature:{properties:[{key:"choreId",value:{name:"number",required:!0}},{key:"startHour",value:{name:"number",required:!0}}]}},name:"payload"}],return:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}}},description:""}}};const De=e=>["groups",e,"chores"],O=(e,o)=>["groups",e,"beatings",o],Ae=e=>{const o=e??"";return H({queryKey:De(o),queryFn:()=>J({groupId:o}),enabled:!!e})},Be=()=>{const e=F(),{showError:o,closeError:t,getModalMessage:n}=de();return V({mutationFn:({groupId:a,choreId:s,startHour:i})=>K({groupId:a,chore_id:s,beated_at:Ie(i)}),onSuccess:async(a,s)=>{const i=C(h());await e.invalidateQueries({queryKey:O(s.groupId,i)}),t()},onError:a=>{const s=a instanceof Y?a.status:void 0,i=a instanceof Error&&a.message?a.message:"討伐記録の作成に失敗しました";o({title:"討伐エラー",message:s?n(s):i})}})},M=e=>(e?.trim()??"")||"名前",Ee=e=>e.map(o=>({timeLabel:o.hour,items:o.items.map(t=>{const n=t.messages.map(a=>({id:String(a.id),userName:M(a.user_name),userImageUrl:a.img_url,mainMessage:a.main_message,describeMessage:a.description_message??void 0}));return{id:String(t.beating_id),choreIconCode:t.icon_code,choreName:t.chore_name,userName:M(t.user_name),userImageUrl:t.img_url,likeCount:t.thanks_count,commentCount:n.length,messages:n}})})),Oe=(e,o)=>{const t=e??"",n=o??C(h());return H({queryKey:O(t,n),queryFn:()=>W({groupId:t,date:n}),select:Ee,enabled:!!e})},Re="_navigator_x4dof_1",Ue="_navButton_x4dof_8",ze="_navSpacer_x4dof_37",Qe="_center_x4dof_41",Je="_label_x4dof_49",Fe="_todayLabel_x4dof_56",Ve="_todayButton_x4dof_62",d={navigator:Re,navButton:Ue,navSpacer:ze,center:Qe,label:Je,todayLabel:Fe,todayButton:Ve};function R({label:e,isToday:o,canGoNext:t,onPrev:n,onNext:a,onReset:s}){return r.jsx("div",{className:d.card,children:r.jsx(re,{padding:"sm",children:r.jsxs("div",{className:d.navigator,role:"group","aria-label":"日付の切り替え",children:[r.jsxs("button",{type:"button",className:d.navButton,onClick:n,children:[r.jsx(ge,{size:18,"aria-hidden":!0}),"前日"]}),r.jsxs("div",{className:d.center,children:[r.jsx("p",{className:d.label,children:e}),o?r.jsx("span",{className:d.todayLabel,children:"今日"}):r.jsxs("button",{type:"button",className:d.todayButton,onClick:s,children:[r.jsx(me,{size:14,"aria-hidden":!0}),"今日に戻る"]})]}),t?r.jsxs("button",{type:"button",className:d.navButton,onClick:a,children:["次の日",r.jsx(_e,{size:18,"aria-hidden":!0})]}):r.jsx("div",{className:d.navSpacer,"aria-hidden":!0})]})})})}R.__docgenInfo={description:"",methods:[],displayName:"DateNavigator",props:{label:{required:!0,tsType:{name:"string"},description:""},isToday:{required:!0,tsType:{name:"boolean"},description:""},canGoNext:{required:!0,tsType:{name:"boolean"},description:""},onPrev:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onNext:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onReset:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}};const Ke=e=>{const o=B(e),{year:t,month:n,day:a,weekday:s}=g(o);return`${t}年${String(Number(n))}月${String(Number(a))}日 (${s})`};function U(){const{groupId:e}=ke(),o=l.useMemo(()=>C(h()),[]),[t,n]=l.useState(()=>o),[a,s]=l.useState(!1),{data:i,isLoading:f}=Ae(e),{data:_,isLoading:b}=Oe(e,t),{mutateAsync:k,isPending:v}=Be(),y=t===o,w=t<o,x=i?.map(c=>({value:String(c.id),label:c.name,icon:r.jsx("span",{"aria-hidden":!0,children:ce(c.icon_code)})}))??[];return r.jsxs(r.Fragment,{children:[r.jsx(E,{open:a,onOpenChange:s,choreOptions:x,choresLoading:f,isSubmitting:v,onSubmit:async({choreId:c,startHour:$})=>{e&&await k({groupId:e,choreId:c,startHour:$})}}),r.jsx(R,{label:Ke(t),isToday:y,canGoNext:w,onPrev:()=>{n(c=>I(c,-1))},onNext:()=>{n(c=>I(c,1))},onReset:()=>{n(o)}}),r.jsx(ue,{beatingGroups:_??[],isLoading:b,isToday:y}),y?r.jsx("button",{type:"button",className:Se.floatingAction,"aria-label":"バトルを開く","aria-haspopup":"dialog",onClick:()=>{s(!0)},children:r.jsx(L,{size:30})}):null]})}U.__docgenInfo={description:"",methods:[],displayName:"GroupHomePage"};const G="group-1",P="永井家",Ye={id:"user-1",name:"山田 花子",email:"hanako@example.com",image:null},We=[{id:1,name:"食器洗い",icon_code:"dish-wash"},{id:2,name:"掃除",icon_code:"cleaning"},{id:3,name:"洗濯",icon_code:"laundry"}],Mt={component:U,parameters:{layout:"fullscreen",msw:{handlers:[Z.get(/\/api\/groups\/[^/]+\/chores$/,()=>te.json(We))]}},decorators:[e=>{const o=new X({defaultOptions:{queries:{refetchOnWindowFocus:!1}}});return r.jsx(ee,{client:o,children:r.jsx(oe,{children:r.jsx(A,{value:{groupId:G,groupName:P,navItems:we(G,P),currentUser:Ye},children:r.jsx(e,{})})})})}]},N={};N.parameters={...N.parameters,docs:{...N.parameters?.docs,source:{originalSource:"{}",...N.parameters?.docs?.source}}};const Gt=["Default"];export{N as Default,Gt as __namedExportsOrder,Mt as default};
