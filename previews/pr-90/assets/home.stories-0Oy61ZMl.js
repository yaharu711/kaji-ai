import{j as n}from"./jsx-runtime-u17CrQMm.js";import{u as L,h as F,H as V}from"./useQuery-BlEsUB-h.js";import{u as K,Q as Y,a as W}from"./QueryClientProvider-oD_t8xT0.js";import{E as Z}from"./index-Cq1iH2TR.js";import{r as u}from"./iframe-DeiQN-Kw.js";import{c as m}from"./createLucideIcon-C_imvSua.js";import{S as X}from"./settings-CUgMc85Z.js";import{P as ee}from"./index-D26oWmff.js";import"./index-xZcLbmLY.js";import{H as te}from"./index-B4vVjiGa.js";import"./index-BKtDPDeF.js";import"./index-DQ-LwqFy.js";import{L as oe}from"./index-VA9SlIaW.js";import"./index-Cj_gcT_w.js";import"./index-BuxXJM99.js";import"./index-CCcWb50U.js";import"./index-D0PcDF2F.js";import{D as A}from"./index-DtyaugAN.js";import{a as I,S as re}from"./index-B6UEh_u6.js";import"./index-C7Fgn_lq.js";import"./index-D9Lnau_G.js";import{A as ne}from"./index-NkOoE0sF.js";import{f as ae,u as se,c as ie,A as ce,a as de}from"./index-JBafH4ca.js";import{G as ue,a as B}from"./index-CNTGNRSe.js";import{g as le}from"./chores-Hta7grnG.js";import{u as me}from"./useErrorModal-DEp-Fg2q.js";import{G as pe}from"./index-D5FEF7Od.js";import"./preload-helper-PPVm8Dsz.js";import"./index-Bh5WiX_1.js";import"./Combination-DmWxasXW.js";import"./index-BbjqgwzX.js";import"./index-DxDWbSu4.js";import"./x-B6aMB6pK.js";import"./proxy-nd__3IZm.js";import"./chunk-JMJ3UQ3L-DG6DSEd-.js";import"./crown-CodrkFqf.js";import"./index-DCEr8y7i.js";import"./chevron-down-JT4wqBqi.js";import"./check-Bc1Om9-A.js";import"./heart-D1KzXJUA.js";import"./index-CG3JnhLL.js";const he=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],ye=m("calendar",he);const ge=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],fe=m("chart-column",ge);const _e=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],be=m("chevron-left",_e);const ve=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],xe=m("chevron-right",ve);const Ne=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]],we=m("clipboard-list",Ne);const je=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16.5 12",key:"1aq6pp"}]],ke=m("clock-3",je);const Ce=[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]],Te=m("house",Ce),D=u.createContext(null);function E({value:e,children:a}){return n.jsx(D.Provider,{value:e,children:a})}function Se(){const e=u.useContext(D);if(!e)throw new Error("GroupLayoutProvider が見つかりません。グループ配下のレイアウトでラップしてください。");return e}E.__docgenInfo={description:"",methods:[],displayName:"GroupLayoutProvider",props:{value:{required:!0,tsType:{name:"GroupLayoutValue"},description:""},children:{required:!0,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:""}}};const Ie=(e,a,t)=>{const r=`/groups/${e}`,o={groupName:a};return[{label:"ホーム",to:r,icon:Te,isActive:t===r,state:o},{label:"レポート",to:`${r}/reports`,icon:fe,isActive:t===`${r}/reports`,state:o},{label:"家事",to:`${r}/chores`,icon:we,isActive:t===`${r}/chores`,state:o},{label:"設定",to:`${r}/settings`,icon:X,isActive:t===`${r}/settings`,state:o}]},$e="_floatingAction_id09l_1",Ae={floatingAction:$e},Me=e=>new Intl.DateTimeFormat("ja-JP",{timeZone:"Asia/Tokyo",...e}),y=()=>new Date,O=e=>new Date(`${e}T00:00:00+09:00`),_=e=>{const t=Me({year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",hour12:!1,weekday:"short"}).formatToParts(e),r=o=>t.find(s=>s.type===o)?.value??"";return{year:r("year"),month:r("month"),day:r("day"),hour:r("hour"),weekday:r("weekday")}},j=e=>{const{year:a,month:t,day:r}=_(e);return`${a}-${t}-${r}`},He=(e,a=y())=>{const{year:t,month:r,day:o}=_(a),s=String(e).padStart(2,"0");return`${t}-${r}-${o}T${s}:00:00+09:00`},M=(e,a)=>{const t=O(e);return t.setUTCDate(t.getUTCDate()+a),j(t)},qe="_form_1tqiv_1",Ge="_section_1tqiv_7",Pe="_sectionHeader_1tqiv_13",Le="_sectionIcon_1tqiv_22",l={form:qe,section:Ge,sectionHeader:Pe,sectionIcon:Le},w=e=>`${String(e)}時`,Be=e=>Array.from({length:24},(a,t)=>{const r=w(t),o=w((t+1)%24),s=`${r}〜${o}`;return{value:s,label:s,disabled:t>e}}),H=()=>{const e=y(),a=_(e).hour,t=Number(a),r=Number.isNaN(t)?e.getHours():t,o=w(r),s=w((r+1)%24);return`${o}〜${s}`},De=e=>{const a=/^(\d{1,2})時〜/.exec(e);if(!a)return null;const t=Number(a[1]);return Number.isNaN(t)||t<0||t>23?null:t};function R({open:e,onOpenChange:a,choreOptions:t,choresLoading:r=!1,isSubmitting:o=!1,onSubmit:s}){const[i,g]=u.useState(void 0),[b,v]=u.useState(H),k=!i||o,x=_(y()),C=Number(x.hour),T=Be(C),p=x,S=`本日 ${`${p.month}月${p.day}日`}の討伐として記録されます！`,c=()=>{g(void 0),v(H())},f=h=>{!h&&o||(h||c(),a(h))},J=async()=>{if(!i||o)return;const h=De(b);if(h!==null)try{await s({choreId:Number(i),startHour:h}),f(!1)}catch{}};return n.jsx(te,{open:e,onOpenChange:f,title:"家事を討伐する",headerIcon:n.jsx(re,{size:"sm","aria-hidden":!0}),primaryActionLabel:"討伐完了",secondaryActionLabel:"キャンセル",primaryActionIcon:n.jsx(I,{size:"18","aria-hidden":!0}),primaryActionDisabled:k,primaryActionLoading:o,secondaryActionDisabled:o,onPrimaryAction:()=>{J()},onSecondaryAction:()=>{f(!1)},children:n.jsxs("div",{className:l.form,children:[n.jsxs("section",{className:l.section,"aria-labelledby":"chore-select-heading",children:[n.jsxs("div",{id:"chore-select-heading",className:l.sectionHeader,children:[n.jsx(I,{className:l.sectionIcon,"aria-hidden":!0}),n.jsx("span",{children:"討伐する家事を選択"})]}),n.jsx(A,{placeholder:"家事を選択しよう！",emptyMessage:r?n.jsx(oe,{size:"md",ariaLabel:"家事を読み込み中"}):"討伐する家事がありません、、！",options:t,value:i,onChange:g,disabled:r})]}),n.jsxs("section",{className:l.section,"aria-labelledby":"battle-time-heading",children:[n.jsxs("div",{id:"battle-time-heading",className:l.sectionHeader,children:[n.jsx(ke,{className:l.sectionIcon,"aria-hidden":!0}),n.jsx("span",{children:"討伐時刻"})]}),n.jsx(A,{options:T,value:b,onChange:v,helperText:S,helperTextVariant:"notice"})]})]})})}R.__docgenInfo={description:"",methods:[],displayName:"ChoreBeatingModal",props:{open:{required:!0,tsType:{name:"boolean"},description:""},onOpenChange:{required:!0,tsType:{name:"signature",type:"function",raw:"(open: boolean) => void",signature:{arguments:[{type:{name:"boolean"},name:"open"}],return:{name:"void"}}},description:""},choreOptions:{required:!0,tsType:{name:"Array",elements:[{name:"DropdownOption"}],raw:"DropdownOption[]"},description:""},choresLoading:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},isSubmitting:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},onSubmit:{required:!0,tsType:{name:"signature",type:"function",raw:"(payload: { choreId: number; startHour: number }) => Promise<void>",signature:{arguments:[{type:{name:"signature",type:"object",raw:"{ choreId: number; startHour: number }",signature:{properties:[{key:"choreId",value:{name:"number",required:!0}},{key:"startHour",value:{name:"number",required:!0}}]}},name:"payload"}],return:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}}},description:""}}};const Ee=e=>{const a=e??"";return L({queryKey:ue(a),queryFn:()=>ae({groupId:a}),enabled:!!e})},Oe=()=>{const e=K(),{showError:a,closeError:t,getModalMessage:r}=me();return se({mutationFn:({groupId:o,choreId:s,startHour:i})=>ie({groupId:o,chore_id:s,beated_at:He(i)}),onSuccess:async(o,s)=>{const i=j(y());await e.invalidateQueries({queryKey:B(s.groupId,i)}),t()},onError:o=>{const s=o instanceof ce?o.status:void 0,i=o instanceof Error&&o.message?o.message:"討伐記録の作成に失敗しました";a({title:"討伐エラー",message:s?r(s):i})}})},q=e=>(e?.trim()??"")||"名前",Re=(e,a,t)=>e.map(r=>({timeLabel:r.hour,items:r.items.map(o=>{const s=o.messages.map(i=>({id:String(i.id),userName:q(i.user_name),userImageUrl:i.img_url,mainMessage:i.main_message,describeMessage:i.description_message??void 0}));return{id:String(o.beating_id),beatingId:o.beating_id,groupId:a,date:t,choreIconCode:o.icon_code,choreName:o.chore_name,userName:q(o.user_name),userImageUrl:o.img_url,likeCount:o.thanks_count,likedByMe:o.liked_by_me,commentCount:s.length,messages:s}})})),Ue=(e,a)=>{const t=e??"",r=a??j(y());return L({queryKey:B(t,r),queryFn:()=>de({groupId:t,date:r}),select:o=>Re(o,t,r),enabled:!!e})},ze="_navigator_x4dof_1",Qe="_navButton_x4dof_8",Je="_navSpacer_x4dof_37",Fe="_center_x4dof_41",Ve="_label_x4dof_49",Ke="_todayLabel_x4dof_56",Ye="_todayButton_x4dof_62",d={navigator:ze,navButton:Qe,navSpacer:Je,center:Fe,label:Ve,todayLabel:Ke,todayButton:Ye};function U({label:e,isToday:a,canGoNext:t,onPrev:r,onNext:o,onReset:s}){return n.jsx("div",{className:d.card,children:n.jsx(ee,{padding:"sm",children:n.jsxs("div",{className:d.navigator,role:"group","aria-label":"日付の切り替え",children:[n.jsxs("button",{type:"button",className:d.navButton,onClick:r,children:[n.jsx(be,{size:18,"aria-hidden":!0}),"前日"]}),n.jsxs("div",{className:d.center,children:[n.jsx("p",{className:d.label,children:e}),a?n.jsx("span",{className:d.todayLabel,children:"今日"}):n.jsxs("button",{type:"button",className:d.todayButton,onClick:s,children:[n.jsx(ye,{size:14,"aria-hidden":!0}),"今日に戻る"]})]}),t?n.jsxs("button",{type:"button",className:d.navButton,onClick:o,children:["次の日",n.jsx(xe,{size:18,"aria-hidden":!0})]}):n.jsx("div",{className:d.navSpacer,"aria-hidden":!0})]})})})}U.__docgenInfo={description:"",methods:[],displayName:"DateNavigator",props:{label:{required:!0,tsType:{name:"string"},description:""},isToday:{required:!0,tsType:{name:"boolean"},description:""},canGoNext:{required:!0,tsType:{name:"boolean"},description:""},onPrev:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onNext:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onReset:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}};const z="kaji:add-to-home-modal:hide",We=()=>typeof window>"u"?!1:window.localStorage.getItem(z)!=="true",Ze=()=>{typeof window>"u"||window.localStorage.setItem(z,"true")},Xe=e=>{const a=O(e),{year:t,month:r,day:o,weekday:s}=_(a);return`${t}年${String(Number(r))}月${String(Number(o))}日 (${s})`};function Q(){const{groupId:e}=Se(),a=u.useMemo(()=>j(y()),[]),[t,r]=u.useState(()=>a),[o,s]=u.useState(!1),[i,g]=u.useState(!1),{data:b,isLoading:v}=Ee(e),{data:k,isLoading:x}=Ue(e,t),{mutateAsync:C,isPending:T}=Oe(),p=t===a,$=t<a;u.useEffect(()=>{if(!We())return;const c=window.setTimeout(()=>{g(!0)},500);return()=>{window.clearTimeout(c)}},[]);const S=b?.map(c=>({value:String(c.id),label:c.name,icon:n.jsx("span",{"aria-hidden":!0,children:le(c.icon_code)})}))??[];return n.jsxs(n.Fragment,{children:[n.jsx(R,{open:o,onOpenChange:s,choreOptions:S,choresLoading:v,isSubmitting:T,onSubmit:async({choreId:c,startHour:f})=>{e&&await C({groupId:e,choreId:c,startHour:f})}}),n.jsx(ne,{open:i,onClose:c=>{c&&Ze(),g(!1)}}),n.jsx(U,{label:Xe(t),isToday:p,canGoNext:$,onPrev:()=>{r(c=>M(c,-1))},onNext:()=>{r(c=>M(c,1))},onReset:()=>{r(a)}}),n.jsx(pe,{beatingGroups:k??[],isLoading:x,isToday:p}),p?n.jsx("button",{type:"button",className:Ae.floatingAction,"aria-label":"バトルを開く","aria-haspopup":"dialog",onClick:()=>{s(!0)},children:n.jsx(I,{size:30})}):null]})}Q.__docgenInfo={description:"",methods:[],displayName:"GroupHomePage"};const G="group-1",P="永井家",et={id:"user-1",name:"山田 花子",email:"hanako@example.com",image:null},tt=[{id:1,name:"食器洗い",icon_code:"dish-wash"},{id:2,name:"掃除",icon_code:"cleaning"},{id:3,name:"洗濯",icon_code:"laundry"}],Ut={component:Q,parameters:{layout:"fullscreen",msw:{handlers:[F.get(/\/api\/groups\/[^/]+\/chores$/,()=>V.json(tt))]}},decorators:[e=>{const a=new Y({defaultOptions:{queries:{refetchOnWindowFocus:!1}}});return n.jsx(W,{client:a,children:n.jsx(Z,{children:n.jsx(E,{value:{groupId:G,groupName:P,navItems:Ie(G,P),currentUser:et},children:n.jsx(e,{})})})})}]},N={};N.parameters={...N.parameters,docs:{...N.parameters?.docs,source:{originalSource:"{}",...N.parameters?.docs?.source}}};const zt=["Default"];export{N as Default,zt as __namedExportsOrder,Ut as default};
