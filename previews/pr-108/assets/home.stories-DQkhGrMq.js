import{j as r}from"./jsx-runtime-u17CrQMm.js";import{u as L,h as F,H as V}from"./useQuery-DE_0WEUO.js";import{u as K,Q as Y,a as W}from"./QueryClientProvider-mqV0tsXG.js";import{E as Z}from"./index-11nxwiRZ.js";import{r as l}from"./iframe-xb1t4ZHU.js";import{c as y}from"./createLucideIcon-ALLVZysa.js";import{S as X}from"./settings-MkvOHNT2.js";import{P as ee}from"./index-D26oWmff.js";import"./index-Dw6XdV9w.js";import{H as te}from"./index-DkuMBG6Z.js";import"./index-BKtDPDeF.js";import"./index-BbYEqis7.js";import{L as oe}from"./index-xStBQTld.js";import"./index-BMzV_JQZ.js";import"./index-4M5G--cH.js";import"./index-CjrsdldT.js";import"./index-B8DQYi4t.js";import{D as A}from"./index-2CMqI9qZ.js";import{a as $,S as re}from"./index-DeVhjKW9.js";import"./index-DxCT0jSL.js";import"./index-w4-gtbO9.js";import"./index-BBGZHdYo.js";import{A as ne}from"./index-Dd1u7N6U.js";import{f as ae,u as se,c as ie,A as ce,a as de}from"./index-DWDA5Y6j.js";import{G as ue,a as D}from"./index-BSKLz3O-.js";import{g as le}from"./index-CY7XgSBG.js";import{u as me}from"./useErrorModal-CN6N-1pa.js";import{G as pe}from"./index-ChLCZe3N.js";import"./preload-helper-PPVm8Dsz.js";import"./index-E3Bzbfbg.js";import"./Combination-D0EORKNu.js";import"./index-BaPV0b--.js";import"./index-DbigGyZM.js";import"./x-M_bBhYij.js";import"./chunk-JMJ3UQ3L-Va4VT4Fx.js";import"./index-BodGhM6m.js";import"./check-B3XZbkPn.js";import"./heart-CqZcBubr.js";import"./index-DpeSdzau.js";import"./filter-props-BCmY_FN0.js";const he=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],ye=y("calendar",he);const ge=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],fe=y("chart-column",ge);const _e=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],be=y("chevron-left",_e);const ve=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],xe=y("chevron-right",ve);const Ne=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]],we=y("clipboard-list",Ne);const je=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16.5 12",key:"1aq6pp"}]],ke=y("clock-3",je);const Ce=[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]],Te=y("house",Ce),E=l.createContext(null);function O({value:e,children:s}){return r.jsx(E.Provider,{value:e,children:s})}function Se(){const e=l.useContext(E);if(!e)throw new Error("GroupLayoutProvider が見つかりません。グループ配下のレイアウトでラップしてください。");return e}O.__docgenInfo={description:"",methods:[],displayName:"GroupLayoutProvider",props:{value:{required:!0,tsType:{name:"GroupLayoutValue"},description:""},children:{required:!0,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:""}}};const Ie=(e,s,n)=>{const t=`/groups/${e}`,o={groupName:s};return[{label:"ホーム",to:t,icon:Te,isActive:n===t,state:o},{label:"レポート",to:`${t}/reports`,icon:fe,isActive:n===`${t}/reports`,state:o},{label:"家事",to:`${t}/chores`,icon:we,isActive:n===`${t}/chores`,state:o},{label:"設定",to:`${t}/settings`,icon:X,isActive:n===`${t}/settings`,state:o}]},$e="_floatingAction_id09l_1",Me={floatingAction:$e},Ae=e=>new Intl.DateTimeFormat("ja-JP",{timeZone:"Asia/Tokyo",...e}),g=()=>new Date,R=e=>new Date(`${e}T00:00:00+09:00`),v=e=>{const n=Ae({year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",hour12:!1,weekday:"short"}).formatToParts(e),t=o=>n.find(a=>a.type===o)?.value??"";return{year:t("year"),month:t("month"),day:t("day"),hour:t("hour"),weekday:t("weekday")}},k=e=>{const{year:s,month:n,day:t}=v(e);return`${s}-${n}-${t}`},qe=(e,s=g())=>{const{year:n,month:t,day:o}=v(s),a=String(e).padStart(2,"0");return`${n}-${t}-${o}T${a}:00:00+09:00`},q=(e,s)=>{const n=R(e);return n.setUTCDate(n.getUTCDate()+s),k(n)},He="_form_1tqiv_1",Ge="_section_1tqiv_7",Be="_sectionHeader_1tqiv_13",Pe="_sectionIcon_1tqiv_22",h={form:He,section:Ge,sectionHeader:Be,sectionIcon:Pe},j=e=>`${String(e)}時`,Le=e=>Array.from({length:24},(s,n)=>{const t=j(n),o=j((n+1)%24),a=`${t}〜${o}`;return{value:a,label:a,disabled:n>e}}),H=()=>{const e=g(),s=v(e).hour,n=Number(s),t=Number.isNaN(n)?e.getHours():n,o=j(t),a=j((t+1)%24);return`${o}〜${a}`},De=e=>{const s=/^(\d{1,2})時〜/.exec(e);if(!s)return null;const n=Number(s[1]);return Number.isNaN(n)||n<0||n>23?null:n};function U({open:e,onOpenChange:s,choreOptions:n,choresLoading:t=!1,isSubmitting:o=!1,onSubmit:a}){const[c,m]=l.useState(void 0),[d,f]=l.useState(H),C=!c||o,x=v(g()),T=Number(x.hour),S=Le(T),N=x,_=`本日 ${`${N.month}月${N.day}日`}の討伐として記録されます！`,I=()=>{m(void 0),f(H())},b=p=>{!p&&o||(p||I(),s(p))},i=async()=>{if(!c||o)return;const p=De(d);if(p!==null)try{await a({choreId:Number(c),startHour:p}),b(!1)}catch{}};return r.jsx(te,{open:e,onOpenChange:b,title:"家事の討伐を記録！",headerIcon:r.jsx(re,{size:"sm","aria-hidden":!0}),primaryActionLabel:"討伐完了",secondaryActionLabel:"キャンセル",primaryActionIcon:r.jsx($,{size:"18","aria-hidden":!0}),primaryActionDisabled:C,primaryActionLoading:o,secondaryActionDisabled:o,onPrimaryAction:()=>{i()},onSecondaryAction:()=>{b(!1)},children:r.jsxs("div",{className:h.form,children:[r.jsxs("section",{className:h.section,"aria-labelledby":"chore-select-heading",children:[r.jsxs("div",{id:"chore-select-heading",className:h.sectionHeader,children:[r.jsx($,{className:h.sectionIcon,"aria-hidden":!0}),r.jsx("span",{children:"討伐する家事を選択"})]}),r.jsx(A,{placeholder:"家事を選択",emptyMessage:t?r.jsx(oe,{size:"md",ariaLabel:"家事を読み込み中"}):"討伐する家事がありません、、！",options:n,value:c,onChange:m,disabled:t})]}),r.jsxs("section",{className:h.section,"aria-labelledby":"battle-time-heading",children:[r.jsxs("div",{id:"battle-time-heading",className:h.sectionHeader,children:[r.jsx(ke,{className:h.sectionIcon,"aria-hidden":!0}),r.jsx("span",{children:"討伐時刻"})]}),r.jsx(A,{options:S,value:d,onChange:f,helperText:_,helperTextVariant:"notice"})]})]})})}U.__docgenInfo={description:"",methods:[],displayName:"ChoreBeatingModal",props:{open:{required:!0,tsType:{name:"boolean"},description:""},onOpenChange:{required:!0,tsType:{name:"signature",type:"function",raw:"(open: boolean) => void",signature:{arguments:[{type:{name:"boolean"},name:"open"}],return:{name:"void"}}},description:""},choreOptions:{required:!0,tsType:{name:"Array",elements:[{name:"DropdownOption"}],raw:"DropdownOption[]"},description:""},choresLoading:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},isSubmitting:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},onSubmit:{required:!0,tsType:{name:"signature",type:"function",raw:"(payload: { choreId: number; startHour: number }) => Promise<void>",signature:{arguments:[{type:{name:"signature",type:"object",raw:"{ choreId: number; startHour: number }",signature:{properties:[{key:"choreId",value:{name:"number",required:!0}},{key:"startHour",value:{name:"number",required:!0}}]}},name:"payload"}],return:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}}},description:""}}};const Ee=e=>{const s=e??"";return L({queryKey:ue(s),queryFn:()=>ae({groupId:s}),enabled:!!e})},Oe=()=>{const e=K(),{showError:s,closeError:n,getModalMessage:t}=me();return se({mutationFn:({groupId:o,choreId:a,startHour:c})=>ie({groupId:o,chore_id:a,beated_at:qe(c)}),onSuccess:async(o,a)=>{const c=k(g());await e.invalidateQueries({queryKey:D(a.groupId,c)}),n()},onError:o=>{const a=o instanceof ce?o.status:void 0,c=o instanceof Error&&o.message?o.message:"討伐記録の作成に失敗しました";s({title:"討伐エラー",message:a?t(a):c})}})},G=e=>(e?.trim()??"")||"名前",Re=(e,s,n,t)=>e.map(o=>({timeLabel:o.hour,items:o.items.map(a=>{const c=t?a.user_id===t:!1,m=a.messages.map(d=>({id:String(d.id),userName:G(d.user_name),userImageUrl:d.img_url,mainMessage:d.main_message,describeMessage:d.description_message??void 0,isMyBeating:d.user_id===a.user_id}));return{id:String(a.beating_id),beatingId:a.beating_id,groupId:s,date:n,choreIconCode:a.icon_code,choreName:a.chore_name,userName:G(a.user_name),userImageUrl:a.img_url,likeCount:a.thanks_count,likedByMe:a.liked_by_me,messagedByMe:a.messaged_by_me,commentCount:m.length,isMyBeating:c,messages:m}})})),Ue=(e,s,n)=>{const t=e??"",o=s??k(g());return L({queryKey:D(t,o),queryFn:()=>de({groupId:t,date:o}),select:a=>Re(a,t,o,n),enabled:!!e})},ze="_navigator_x4dof_1",Qe="_navButton_x4dof_8",Je="_navSpacer_x4dof_37",Fe="_center_x4dof_41",Ve="_label_x4dof_49",Ke="_todayLabel_x4dof_56",Ye="_todayButton_x4dof_62",u={navigator:ze,navButton:Qe,navSpacer:Je,center:Fe,label:Ve,todayLabel:Ke,todayButton:Ye};function z({label:e,isToday:s,canGoNext:n,onPrev:t,onNext:o,onReset:a}){return r.jsx("div",{className:u.card,children:r.jsx(ee,{padding:"sm",children:r.jsxs("div",{className:u.navigator,role:"group","aria-label":"日付の切り替え",children:[r.jsxs("button",{type:"button",className:u.navButton,onClick:t,children:[r.jsx(be,{size:18,"aria-hidden":!0}),"前日"]}),r.jsxs("div",{className:u.center,children:[r.jsx("p",{className:u.label,children:e}),s?r.jsx("span",{className:u.todayLabel,children:"今日"}):r.jsxs("button",{type:"button",className:u.todayButton,onClick:a,children:[r.jsx(ye,{size:14,"aria-hidden":!0}),"今日に戻る"]})]}),n?r.jsxs("button",{type:"button",className:u.navButton,onClick:o,children:["次の日",r.jsx(xe,{size:18,"aria-hidden":!0})]}):r.jsx("div",{className:u.navSpacer,"aria-hidden":!0})]})})})}z.__docgenInfo={description:"",methods:[],displayName:"DateNavigator",props:{label:{required:!0,tsType:{name:"string"},description:""},isToday:{required:!0,tsType:{name:"boolean"},description:""},canGoNext:{required:!0,tsType:{name:"boolean"},description:""},onPrev:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onNext:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onReset:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}};const Q="kaji:add-to-home-modal:hide",We=()=>typeof window>"u"?!1:window.localStorage.getItem(Q)!=="true",Ze=()=>{typeof window>"u"||window.localStorage.setItem(Q,"true")},Xe=e=>{const s=R(e),{year:n,month:t,day:o,weekday:a}=v(s);return`${n}年${String(Number(t))}月${String(Number(o))}日 (${a})`};function J({todayOverride:e}){const{groupId:s,currentUser:n}=Se(),t=l.useMemo(()=>e??k(g()),[e]),[o,a]=l.useState(()=>t),[c,m]=l.useState(!1),[d,f]=l.useState(!1),{data:C,isLoading:x}=Ee(s),{data:T,isLoading:S}=Ue(s,o,n.id),{mutateAsync:N,isPending:M}=Oe(),_=o===t,I=o<t;l.useEffect(()=>{if(!We())return;const i=window.setTimeout(()=>{f(!0)},500);return()=>{window.clearTimeout(i)}},[]);const b=C?.map(i=>({value:String(i.id),label:i.name,icon:r.jsx("span",{"aria-hidden":!0,children:le(i.icon_code)})}))??[];return r.jsxs(r.Fragment,{children:[r.jsx(U,{open:c,onOpenChange:m,choreOptions:b,choresLoading:x,isSubmitting:M,onSubmit:async({choreId:i,startHour:p})=>{s&&await N({groupId:s,choreId:i,startHour:p})}}),r.jsx(ne,{open:d,onClose:i=>{i&&Ze(),f(!1)}}),r.jsx(z,{label:Xe(o),isToday:_,canGoNext:I,onPrev:()=>{a(i=>q(i,-1))},onNext:()=>{a(i=>q(i,1))},onReset:()=>{a(t)}}),r.jsx(pe,{beatingGroups:T??[],isLoading:S,isToday:_}),_?r.jsx("button",{type:"button",className:Me.floatingAction,"aria-label":"バトルを開く","aria-haspopup":"dialog",onClick:()=>{m(!0)},children:r.jsx($,{size:30})}):null]})}J.__docgenInfo={description:"",methods:[],displayName:"GroupHomePage",props:{todayOverride:{required:!1,tsType:{name:"string"},description:""}}};const B="group-1",P="永井家",et={id:"user-1",name:"山田 花子",email:"hanako@example.com",image:null},tt=[{id:1,name:"食器洗い",icon_code:"dish-wash"},{id:2,name:"掃除",icon_code:"cleaning"},{id:3,name:"洗濯",icon_code:"laundry"}],Rt={component:J,parameters:{layout:"fullscreen",msw:{handlers:[F.get(/\/api\/groups\/[^/]+\/chores$/,()=>V.json(tt))]}},decorators:[e=>{const s=new Y({defaultOptions:{queries:{refetchOnWindowFocus:!1}}});return r.jsx(W,{client:s,children:r.jsx(Z,{children:r.jsx(O,{value:{groupId:B,groupName:P,navItems:Ie(B,P),currentUser:et},children:r.jsx(e,{})})})})}]},w={};w.parameters={...w.parameters,docs:{...w.parameters?.docs,source:{originalSource:"{}",...w.parameters?.docs?.source}}};const Ut=["Default"];export{w as Default,Ut as __namedExportsOrder,Rt as default};
