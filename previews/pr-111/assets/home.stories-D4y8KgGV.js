import{j as n}from"./jsx-runtime-u17CrQMm.js";import{u as D,h as K,H as Y}from"./useQuery-BvsAiDXI.js";import{u as W,Q as Z,a as X}from"./QueryClientProvider-BMCchIl4.js";import{E as ee}from"./index-De2_V-S8.js";import{r as l}from"./iframe-CdLyeb6m.js";import{c as g}from"./createLucideIcon-B-yWAdHL.js";import{S as te}from"./settings-lTqHLcRX.js";import{P as oe}from"./index-D26oWmff.js";import"./index-COAzQ30d.js";import{H as ne}from"./index-Cy5lP2GC.js";import"./index-BKtDPDeF.js";import"./index-B5DpYhLs.js";import{L as re}from"./index-BrOBrL7F.js";import"./index-Dzz_JUmW.js";import"./index-BisnGRS6.js";import"./index-KgQFBhLH.js";import"./index-uyzdwiiI.js";import{D as q}from"./index-ClPCH5Uf.js";import{a as M,S as ae}from"./index-Cbe7hXxv.js";import"./index-B5__YZAs.js";import"./index-pNyubZWQ.js";import"./index-BBGZHdYo.js";import{A as se}from"./index-y8UnwNkD.js";import{f as ie,u as ce,c as de,A as ue,a as le}from"./index-9i9U3BBu.js";import{G as me,a as E}from"./index-QMlR8wMB.js";import{g as pe}from"./index-BOOW2jKc.js";import{u as he}from"./useErrorModal-CP7S3eTA.js";import{G as ye}from"./index-N_paXljM.js";import"./preload-helper-PPVm8Dsz.js";import"./index-BKyx4Nv4.js";import"./Combination-CUcpsVkp.js";import"./index-BvwbJulw.js";import"./index-5yzgPyqn.js";import"./x-Db6nCcWx.js";import"./chunk-JMJ3UQ3L-BD8XmwrQ.js";import"./index-lYk79lf5.js";import"./check-DIBib_it.js";import"./heart-BH1imaKI.js";import"./index-B-1GB-aQ.js";import"./filter-props-CyvZY7bW.js";const ge=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],fe=g("calendar",ge);const _e=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],be=g("chart-column",_e);const ve=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],xe=g("chevron-left",ve);const Ne=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],we=g("chevron-right",Ne);const je=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]],ke=g("clipboard-list",je);const Ce=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16.5 12",key:"1aq6pp"}]],Te=g("clock-3",Ce);const Se=[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]],Ie=g("house",Se),O=l.createContext(null);function R({value:e,children:s}){return n.jsx(O.Provider,{value:e,children:s})}function $e(){const e=l.useContext(O);if(!e)throw new Error("GroupLayoutProvider が見つかりません。グループ配下のレイアウトでラップしてください。");return e}R.__docgenInfo={description:"",methods:[],displayName:"GroupLayoutProvider",props:{value:{required:!0,tsType:{name:"GroupLayoutValue"},description:""},children:{required:!0,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:""}}};const Me=(e,s,r)=>{const t=`/groups/${e}`,o={groupName:s};return[{label:"ホーム",to:t,icon:Ie,isActive:r===t,state:o},{label:"レポート",to:`${t}/reports`,icon:be,isActive:r===`${t}/reports`,state:o},{label:"家事",to:`${t}/chores`,icon:ke,isActive:r===`${t}/chores`,state:o},{label:"設定",to:`${t}/settings`,icon:te,isActive:r===`${t}/settings`,state:o}]},Ae="_floatingAction_id09l_1",qe={floatingAction:Ae},He=e=>new Intl.DateTimeFormat("ja-JP",{timeZone:"Asia/Tokyo",...e}),f=()=>new Date,U=e=>new Date(`${e}T00:00:00+09:00`),b=e=>{const r=He({year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",hour12:!1,weekday:"short"}).formatToParts(e),t=o=>r.find(a=>a.type===o)?.value??"";return{year:t("year"),month:t("month"),day:t("day"),hour:t("hour"),weekday:t("weekday")}},j=e=>{const{year:s,month:r,day:t}=b(e);return`${s}-${r}-${t}`},Be=(e,s=f())=>{const{year:r,month:t,day:o}=b(s),a=String(e).padStart(2,"0");return`${r}-${t}-${o}T${a}:00:00+09:00`},H=(e,s)=>{const r=U(e);return r.setUTCDate(r.getUTCDate()+s),j(r)},Ge="_form_1tqiv_1",Pe="_section_1tqiv_7",Le="_sectionHeader_1tqiv_13",De="_sectionIcon_1tqiv_22",y={form:Ge,section:Pe,sectionHeader:Le,sectionIcon:De},w=e=>`${String(e)}時`,Ee=e=>Array.from({length:24},(s,r)=>{const t=w(r),o=w((r+1)%24),a=`${t}〜${o}`;return{value:a,label:a,disabled:r>e}}),B=()=>{const e=f(),s=b(e).hour,r=Number(s),t=Number.isNaN(r)?e.getHours():r,o=w(t),a=w((t+1)%24);return`${o}〜${a}`},Oe=e=>{const s=/^(\d{1,2})時〜/.exec(e);if(!s)return null;const r=Number(s[1]);return Number.isNaN(r)||r<0||r>23?null:r};function z({open:e,onOpenChange:s,choreOptions:r,choresLoading:t=!1,isSubmitting:o=!1,onSubmit:a}){const[i,m]=l.useState(void 0),[d,_]=l.useState(B),k=!i||o,v=b(f()),C=Number(v.hour),T=Ee(C),x=v,S=`本日 ${`${x.month}月${x.day}日`}の討伐として記録されます！`,I=()=>{m(void 0),_(B())},h=p=>{!p&&o||(p||I(),s(p))},$=async()=>{if(!i||o)return;const p=Oe(d);if(p!==null)try{await a({choreId:Number(i),startHour:p}),h(!1)}catch{}};return n.jsx(ne,{open:e,onOpenChange:h,title:"家事の討伐を記録！",headerIcon:n.jsx(ae,{size:"sm","aria-hidden":!0}),primaryActionLabel:"討伐完了",secondaryActionLabel:"キャンセル",primaryActionIcon:n.jsx(M,{size:"18","aria-hidden":!0}),primaryActionDisabled:k,primaryActionLoading:o,secondaryActionDisabled:o,onPrimaryAction:()=>{$()},onSecondaryAction:()=>{h(!1)},children:n.jsxs("div",{className:y.form,children:[n.jsxs("section",{className:y.section,"aria-labelledby":"chore-select-heading",children:[n.jsxs("div",{id:"chore-select-heading",className:y.sectionHeader,children:[n.jsx(M,{className:y.sectionIcon,"aria-hidden":!0}),n.jsx("span",{children:"討伐する家事を選択"})]}),n.jsx(q,{placeholder:"家事を選択",emptyMessage:t?n.jsx(re,{size:"md",ariaLabel:"家事を読み込み中"}):"討伐する家事がありません、、！",options:r,value:i,onChange:m,disabled:t})]}),n.jsxs("section",{className:y.section,"aria-labelledby":"battle-time-heading",children:[n.jsxs("div",{id:"battle-time-heading",className:y.sectionHeader,children:[n.jsx(Te,{className:y.sectionIcon,"aria-hidden":!0}),n.jsx("span",{children:"討伐時刻"})]}),n.jsx(q,{options:T,value:d,onChange:_,helperText:S,helperTextVariant:"notice"})]})]})})}z.__docgenInfo={description:"",methods:[],displayName:"ChoreBeatingModal",props:{open:{required:!0,tsType:{name:"boolean"},description:""},onOpenChange:{required:!0,tsType:{name:"signature",type:"function",raw:"(open: boolean) => void",signature:{arguments:[{type:{name:"boolean"},name:"open"}],return:{name:"void"}}},description:""},choreOptions:{required:!0,tsType:{name:"Array",elements:[{name:"DropdownOption"}],raw:"DropdownOption[]"},description:""},choresLoading:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},isSubmitting:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},onSubmit:{required:!0,tsType:{name:"signature",type:"function",raw:"(payload: { choreId: number; startHour: number }) => Promise<void>",signature:{arguments:[{type:{name:"signature",type:"object",raw:"{ choreId: number; startHour: number }",signature:{properties:[{key:"choreId",value:{name:"number",required:!0}},{key:"startHour",value:{name:"number",required:!0}}]}},name:"payload"}],return:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}}},description:""}}};const Re=e=>{const s=e??"";return D({queryKey:me(s),queryFn:()=>ie({groupId:s}),enabled:!!e})},Ue=()=>{const e=W(),{showError:s,closeError:r,getModalMessage:t}=he();return ce({mutationFn:({groupId:o,choreId:a,startHour:i})=>de({groupId:o,chore_id:a,beated_at:Be(i)}),onSuccess:async(o,a)=>{const i=j(f());await e.invalidateQueries({queryKey:E(a.groupId,i)}),r()},onError:o=>{const a=o instanceof ue?o.status:void 0,i=o instanceof Error&&o.message?o.message:"討伐記録の作成に失敗しました";s({title:"討伐エラー",message:a?t(a):i})}})},G=e=>(e?.trim()??"")||"名前",ze=(e,s,r,t)=>e.map(o=>({timeLabel:o.hour,items:o.items.map(a=>{const i=t?a.user_id===t:!1,m=a.messages.map(d=>({id:String(d.id),userName:G(d.user_name),userImageUrl:d.img_url,mainMessage:d.main_message,describeMessage:d.description_message??void 0,isMyBeating:d.user_id===a.user_id}));return{id:String(a.beating_id),beatingId:a.beating_id,groupId:s,date:r,choreIconCode:a.icon_code,choreName:a.chore_name,userName:G(a.user_name),userImageUrl:a.img_url,likeCount:a.thanks_count,likedByMe:a.liked_by_me,messagedByMe:a.messaged_by_me,commentCount:m.length,isMyBeating:i,messages:m}})})),Qe=(e,s,r)=>{const t=e??"",o=s??j(f());return D({queryKey:E(t,o),queryFn:()=>le({groupId:t,date:o}),select:a=>ze(a,t,o,r),enabled:!!e})},Fe="_navigator_x4dof_1",Je="_navButton_x4dof_8",Ve="_navSpacer_x4dof_37",Ke="_center_x4dof_41",Ye="_label_x4dof_49",We="_todayLabel_x4dof_56",Ze="_todayButton_x4dof_62",u={navigator:Fe,navButton:Je,navSpacer:Ve,center:Ke,label:Ye,todayLabel:We,todayButton:Ze};function Q({label:e,isToday:s,canGoNext:r,onPrev:t,onNext:o,onReset:a}){return n.jsx("div",{className:u.card,children:n.jsx(oe,{padding:"sm",children:n.jsxs("div",{className:u.navigator,role:"group","aria-label":"日付の切り替え",children:[n.jsxs("button",{type:"button",className:u.navButton,onClick:t,children:[n.jsx(xe,{size:18,"aria-hidden":!0}),"前日"]}),n.jsxs("div",{className:u.center,children:[n.jsx("p",{className:u.label,children:e}),s?n.jsx("span",{className:u.todayLabel,children:"今日"}):n.jsxs("button",{type:"button",className:u.todayButton,onClick:a,children:[n.jsx(fe,{size:14,"aria-hidden":!0}),"今日に戻る"]})]}),r?n.jsxs("button",{type:"button",className:u.navButton,onClick:o,children:["次の日",n.jsx(we,{size:18,"aria-hidden":!0})]}):n.jsx("div",{className:u.navSpacer,"aria-hidden":!0})]})})})}Q.__docgenInfo={description:"",methods:[],displayName:"DateNavigator",props:{label:{required:!0,tsType:{name:"string"},description:""},isToday:{required:!0,tsType:{name:"boolean"},description:""},canGoNext:{required:!0,tsType:{name:"boolean"},description:""},onPrev:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onNext:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onReset:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}};const F="kaji:add-to-home-modal:hide",Xe=()=>typeof window>"u"?!1:window.localStorage.getItem(F)!=="true",et=()=>{typeof window>"u"||window.localStorage.setItem(F,"true")},tt=e=>{const s=U(e),{year:r,month:t,day:o,weekday:a}=b(s);return`${r}年${String(Number(t))}月${String(Number(o))}日 (${a})`};function J({todayOverride:e}){const{groupId:s,currentUser:r}=$e(),t=l.useMemo(()=>e??j(f()),[e]),[o,a]=l.useState(()=>t),[i,m]=l.useState(!1),[d,_]=l.useState(!1),{data:k,isLoading:v}=Re(s),{data:C,isLoading:T,isFetching:x,refetch:A}=Qe(s,o,r.id),{mutateAsync:S,isPending:I}=Ue(),h=o===t,$=o<t;l.useEffect(()=>{if(!Xe())return;const c=window.setTimeout(()=>{_(!0)},500);return()=>{window.clearTimeout(c)}},[]);const p=k?.map(c=>({value:String(c.id),label:c.name,icon:n.jsx("span",{"aria-hidden":!0,children:pe(c.icon_code)})}))??[];return n.jsxs(n.Fragment,{children:[n.jsx(z,{open:i,onOpenChange:m,choreOptions:p,choresLoading:v,isSubmitting:I,onSubmit:async({choreId:c,startHour:V})=>{s&&await S({groupId:s,choreId:c,startHour:V})}}),n.jsx(se,{open:d,onClose:c=>{c&&et(),_(!1)}}),n.jsx(Q,{label:tt(o),isToday:h,canGoNext:$,onPrev:()=>{a(c=>H(c,-1))},onNext:()=>{a(c=>H(c,1))},onReset:()=>{a(t)}}),n.jsx(ye,{beatingGroups:C??[],isLoading:T,isToday:h,isRefreshing:x,onRefresh:()=>{A()}}),h?n.jsx("button",{type:"button",className:qe.floatingAction,"aria-label":"バトルを開く","aria-haspopup":"dialog",onClick:()=>{m(!0)},children:n.jsx(M,{size:30})}):null]})}J.__docgenInfo={description:"",methods:[],displayName:"GroupHomePage",props:{todayOverride:{required:!1,tsType:{name:"string"},description:""}}};const P="group-1",L="永井家",ot={id:"user-1",name:"山田 花子",email:"hanako@example.com",image:null},nt=[{id:1,name:"食器洗い",icon_code:"dish-wash"},{id:2,name:"掃除",icon_code:"cleaning"},{id:3,name:"洗濯",icon_code:"laundry"}],zt={component:J,parameters:{layout:"fullscreen",msw:{handlers:[K.get(/\/api\/groups\/[^/]+\/chores$/,()=>Y.json(nt))]}},decorators:[e=>{const s=new Z({defaultOptions:{queries:{refetchOnWindowFocus:!1}}});return n.jsx(X,{client:s,children:n.jsx(ee,{children:n.jsx(R,{value:{groupId:P,groupName:L,navItems:Me(P,L),currentUser:ot},children:n.jsx(e,{})})})})}]},N={};N.parameters={...N.parameters,docs:{...N.parameters?.docs,source:{originalSource:"{}",...N.parameters?.docs?.source}}};const Qt=["Default"];export{N as Default,Qt as __namedExportsOrder,zt as default};
